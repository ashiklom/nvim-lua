{
  "SMCE SSM policy": {
    "prefix": "tf-ssm",
    "description": "Attach SMCE SSM policies",
    "body": [
      "data \"aws_iam_policy\" \"ssm_policies\" {",
      "  for_each = toset([",
      "    \"AmazonEC2RoleforSSM\",",
      "    \"AmazonSSMManagedInstanceCore\",",
      "    \"CloudWatchAgentServerPolicy\",",
      "    \"CloudWatchAgentAdminPolicy\"",
      "  ])",
      "  name = each.value",
      "}",
      "",
      "resource \"aws_iam_role_policy_attachment\" \"ssm_attach\" {",
        "  for_each = data.aws_iam_policy.ssm_policies",
        "  role = aws_iam_role.db_test.name",
        "  policy_arn = each.value.arn",
      "}"
    ]
  },
  "SMCE IAM policy read/write S3": {
    "prefix": "tf-s3rw",
    "description": "IAM policy to allow read/write to S3 bucket(s)",
    "body": [
      "data \"aws_iam_policy_document\" \"s3_rw\" {",
      "  statement {",
      "    sid = \"ListBuckets\"",
      "    actions = [ \"s3:ListAllMyBuckets\" ]",
      "    resources = [\"*\"]",
      "  }",
      "",
      "  statement {",
      "    sid = \"ReadWrite\"",
      "    actions = [",
      "      \"s3:GetObject\",",
      "      \"s3:GetObjectVersion\",",
      "      \"s3:PutObject\",",
      "      \"s3:DeleteObject\",",
      "      \"s3:DeleteObjectVersion\"",
      "    ]",
      "    resources = [",
      "      \"arn:aws:s3:::<bucketname>\",",
      "      \"arn:aws:s3:::<bucketname>/*\"",
      "    ]",
      "  }",
      "}",
      "",
      "resource \"aws_iam_policy\" \"s3_rw\" {",
      "  name = \"s3_rw_all\"",
      "  policy = data.aws_iam_policy_document.s3_rw.json",
      "}",
      "",
      "resource \"aws_iam_role_policy_attachment\" \"s3_rw\" {",
      "  policy_arn = aws_iam_policy.s3_rw.arn",
      "  role = aws_iam_role.db_test.name",
      "}"
    ]
  }
}
